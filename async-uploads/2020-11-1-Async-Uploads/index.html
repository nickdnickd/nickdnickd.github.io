<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.e1dc30a3601f3f545267.css" id="gatsby-global-css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100-8d7d79679b70dbe27172b6460e7a7910.woff2) format("woff2"),url(/static/montserrat-latin-100-ec38980a9e0119a379e2a9b3dbb1901a.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic-e279051046ba1286706adc886cf1c96b.woff2) format("woff2"),url(/static/montserrat-latin-100italic-3b325a3173c8207435cd1b76e19bf501.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200-9d266fbbfa6cab7009bd56003b1eeb67.woff2) format("woff2"),url(/static/montserrat-latin-200-2d8ba08717110d27122e54c34b8a5798.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic-6e5b3756583bb2263eb062eae992735e.woff2) format("woff2"),url(/static/montserrat-latin-200italic-a0d6f343e4b536c582926255367a57da.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300-00b3e893aab5a8fd632d6342eb72551a.woff2) format("woff2"),url(/static/montserrat-latin-300-ea303695ceab35f17e7d062f30e0173b.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic-56f34ea368f6aedf89583d444bbcb227.woff2) format("woff2"),url(/static/montserrat-latin-300italic-54b0bf2c8c4c12ffafd803be2466a790.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400-b71748ae4f80ec8c014def4c5fa8688b.woff2) format("woff2"),url(/static/montserrat-latin-400-0659a9f4e90db5cf51b50d005bff1e41.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic-6eed6b4cbb809c6efc7aa7ddad6dbe3e.woff2) format("woff2"),url(/static/montserrat-latin-400italic-7583622cfde30ae49086d18447ab28e7.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500-091b209546e16313fd4f4fc36090c757.woff2) format("woff2"),url(/static/montserrat-latin-500-edd311588712a96bbf435fad264fff62.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic-c90ced68b46050061d1a41842d6dfb43.woff2) format("woff2"),url(/static/montserrat-latin-500italic-5146cbfe02b1deea5dffea27a5f2f998.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600-0480d2f8a71f38db8633b84d8722e0c2.woff2) format("woff2"),url(/static/montserrat-latin-600-b77863a375260a05dd13f86a1cee598f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic-cf46ffb11f3a60d7df0567f8851a1d00.woff2) format("woff2"),url(/static/montserrat-latin-600italic-c4fcfeeb057724724097167e57bd7801.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700-7dbcc8a5ea2289d83f657c25b4be6193.woff2) format("woff2"),url(/static/montserrat-latin-700-99271a835e1cae8c76ef8bba99a8cc4e.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic-c41ad6bdb4bd504a843d546d0a47958d.woff2) format("woff2"),url(/static/montserrat-latin-700italic-6779372f04095051c62ed36bc1dcc142.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800-db9a3e0ba7eaea32e5f55328ace6cf23.woff2) format("woff2"),url(/static/montserrat-latin-800-4e3c615967a2360f5db87d2f0fd2456f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic-bf45bfa14805969eda318973947bc42b.woff2) format("woff2"),url(/static/montserrat-latin-800italic-fe82abb0bcede51bf724254878e0c374.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900-e66c7edc609e24bacbb705175669d814.woff2) format("woff2"),url(/static/montserrat-latin-900-8211f418baeb8ec880b80ba3c682f957.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic-4454c775e48152c1a72510ceed3603e2.woff2) format("woff2"),url(/static/montserrat-latin-900italic-efcaa0f6a82ee0640b83a0916e6e8d68.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300-fc117160c69a8ea0851b26dd14748ee4.woff2) format("woff2"),url(/static/merriweather-latin-300-58b18067ebbd21fda77b67e73c241d3b.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic-fe29961474f8dbf77c0aa7b9a629e4bc.woff2) format("woff2"),url(/static/merriweather-latin-300italic-23c3f1f88683618a4fb8d265d33d383a.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400-d9479e8023bef9cbd9bf8d6eabd6bf36.woff2) format("woff2"),url(/static/merriweather-latin-400-040426f99ff6e00b86506452e0d1f10b.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic-2de7bfeaf08fb03d4315d49947f062f7.woff2) format("woff2"),url(/static/merriweather-latin-400italic-79db67aca65f5285964ab332bd65f451.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700-4b08e01d805fa35d7bf777f1b24314ae.woff2) format("woff2"),url(/static/merriweather-latin-700-22fb8afba4ab1f093b6ef9e28a9b6e92.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic-cd92541b177652fffb6e3b952f1c33f1.woff2) format("woff2"),url(/static/merriweather-latin-700italic-f87f3d87cea0dd0979bfc8ac9ea90243.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900-f813fc6a4bee46eda5224ac7ebf1b7be.woff2) format("woff2"),url(/static/merriweather-latin-900-5d4e42cb44410674acd99153d57df032.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic-b7901d85486871c1779c0e93ddd85656.woff2) format("woff2"),url(/static/merriweather-latin-900italic-9647f9fdab98756989a8a5550eb205c3.woff) format("woff")}


/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden]{display:none}:root{--maxWidth-none:"none";--maxWidth-xs:20rem;--maxWidth-sm:24rem;--maxWidth-md:28rem;--maxWidth-lg:32rem;--maxWidth-xl:36rem;--maxWidth-2xl:42rem;--maxWidth-3xl:48rem;--maxWidth-4xl:56rem;--maxWidth-full:"100%";--maxWidth-wrapper:var(--maxWidth-2xl);--spacing-px:"1px";--spacing-0:0;--spacing-1:0.25rem;--spacing-2:0.5rem;--spacing-3:0.75rem;--spacing-4:1rem;--spacing-5:1.25rem;--spacing-6:1.5rem;--spacing-8:2rem;--spacing-10:2.5rem;--spacing-12:3rem;--spacing-16:4rem;--spacing-20:5rem;--spacing-24:6rem;--spacing-32:8rem;--fontFamily-sans:Montserrat,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--fontFamily-serif:"Merriweather","Georgia",Cambria,"Times New Roman",Times,serif;--font-body:var(--fontFamily-serif);--font-heading:var(--fontFamily-sans);--fontWeight-normal:400;--fontWeight-medium:500;--fontWeight-semibold:600;--fontWeight-bold:700;--fontWeight-extrabold:800;--fontWeight-black:900;--fontSize-root:16px;--lineHeight-none:1;--lineHeight-tight:1.1;--lineHeight-normal:1.5;--lineHeight-relaxed:1.625;--fontSize-0:0.833rem;--fontSize-1:1rem;--fontSize-2:1.2rem;--fontSize-3:1.44rem;--fontSize-4:1.728rem;--fontSize-5:2.074rem;--fontSize-6:2.488rem;--fontSize-7:2.986rem;--color-primary:#005b99;--color-text:#2e353f;--color-text-light:#4f5969;--color-heading:#1a202c;--color-heading-black:#000;--color-accent:#d1dce5}*,:after,:before{box-sizing:border-box}html{line-height:var(--lineHeight-normal);font-size:var(--fontSize-root);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body{font-family:var(--font-body);font-size:var(--fontSize-1);color:var(--color-text)}footer{padding:var(--spacing-6) var(--spacing-0)}hr{background:var(--color-accent);height:1px;border:0}h1,h2,h3,h4,h5,h6{font-family:var(--font-heading);margin-top:var(--spacing-12);margin-bottom:var(--spacing-6);line-height:var(--lineHeight-tight);letter-spacing:-.025em}h2,h3,h4,h5,h6{font-weight:var(--fontWeight-bold);color:var(--color-heading)}h1{font-weight:var(--fontWeight-black);font-size:var(--fontSize-6);color:var(--color-heading-black)}h2{font-size:var(--fontSize-5)}h3{font-size:var(--fontSize-4)}h4{font-size:var(--fontSize-3)}h5{font-size:var(--fontSize-2)}h6{font-size:var(--fontSize-1)}h1>a,h2>a,h3>a,h4>a,h5>a,h6>a{color:inherit;text-decoration:none}p{line-height:var(--lineHeight-relaxed);--baseline-multiplier:0.179;--x-height-multiplier:0.35;margin:var(--spacing-0) var(--spacing-0) var(--spacing-8) var(--spacing-0)}ol,p,ul{padding:var(--spacing-0)}ol,ul{margin-left:var(--spacing-0);margin-right:var(--spacing-0);margin-bottom:var(--spacing-8);list-style-position:outside;list-style-image:none}ol li,ul li{padding-left:var(--spacing-0)}li>p,ol li,ul li{margin-bottom:calc(var(--spacing-8)/2)}li :last-child{margin-bottom:var(--spacing-0)}li>ul{margin-left:var(--spacing-8);margin-top:calc(var(--spacing-8)/2)}blockquote{color:var(--color-text-light);margin-left:calc(var(--spacing-6)*-1);margin-right:var(--spacing-8);padding:var(--spacing-0) var(--spacing-0) var(--spacing-0) var(--spacing-6);border-left:var(--spacing-1) solid var(--color-primary);font-size:var(--fontSize-2);font-style:italic;margin-bottom:var(--spacing-8)}blockquote>:last-child{margin-bottom:var(--spacing-0)}blockquote>ol,blockquote>ul{list-style-position:inside}table{width:100%;margin-bottom:var(--spacing-8);border-collapse:collapse;border-spacing:.25rem}table thead tr th{border-bottom:1px solid var(--color-accent)}a{color:var(--color-primary)}a:focus,a:hover{text-decoration:none}.global-wrapper{margin:var(--spacing-0) auto;max-width:var(--maxWidth-wrapper);padding:var(--spacing-10) var(--spacing-5)}.global-wrapper[data-is-root-path=true] .bio{margin-bottom:var(--spacing-20)}.global-header{margin-bottom:var(--spacing-12)}.main-heading{font-size:var(--fontSize-7);margin:0}.post-list-item{margin-bottom:var(--spacing-8);margin-top:var(--spacing-8)}.post-list-item p{margin-bottom:var(--spacing-0)}.post-list-item h2{font-size:var(--fontSize-4);color:var(--color-primary);margin-bottom:var(--spacing-2);margin-top:var(--spacing-0)}.post-list-item header{margin-bottom:var(--spacing-4)}.header-link-home{font-weight:var(--fontWeight-bold);font-family:var(--font-heading);text-decoration:none;font-size:var(--fontSize-2)}.bio{display:flex;margin-bottom:var(--spacing-16)}.bio-avatar,.bio p{margin-bottom:var(--spacing-0)}.bio-avatar{margin-right:var(--spacing-4);min-width:50px;border-radius:100%}.blog-post header h1{margin:var(--spacing-0) var(--spacing-0) var(--spacing-4) var(--spacing-0)}.blog-post header p{font-size:var(--fontSize-2);font-family:var(--font-heading)}.blog-post-nav ul{margin:var(--spacing-0)}.gatsby-highlight{margin-bottom:var(--spacing-8)}@media (max-width:42rem){blockquote{padding:var(--spacing-0) var(--spacing-0) var(--spacing-0) var(--spacing-4);margin-left:var(--spacing-0)}ol,ul{list-style-position:inside}}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 3.3.0"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=4a9773549091c227cd2eb82ccd9c5e3a" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><title data-react-helmet="true">Asynchronous Uploads | Nick D Blog</title><meta data-react-helmet="true" name="description" content="Using Tokio and Rusoto"/><meta data-react-helmet="true" property="og:title" content="Asynchronous Uploads"/><meta data-react-helmet="true" property="og:description" content="Using Tokio and Rusoto"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="nickdnickd"/><meta data-react-helmet="true" name="twitter:title" content="Asynchronous Uploads"/><meta data-react-helmet="true" name="twitter:description" content="Using Tokio and Rusoto"/><link as="script" rel="preload" href="/webpack-runtime-9b020be59ce6ce109edf.js"/><link as="script" rel="preload" href="/framework-341c3c82f92be86019fb.js"/><link as="script" rel="preload" href="/app-53f7db7d85c07ecc7c96.js"/><link as="script" rel="preload" href="/commons-ab2410dfbec4227df496.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-b372affe070b4abe70a5.js"/><link as="fetch" rel="preload" href="/page-data/async-uploads/2020-11-1-Async-Uploads/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2841359383.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3257411868.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="global-wrapper" data-is-root-path="false"><header class="global-header"><a class="header-link-home" href="/">Nick D Blog</a></header><main><article class="blog-post" itemscope="" itemType="http://schema.org/Article"><header><h1 itemProp="headline">Asynchronous Uploads</h1><p>November 01, 2020</p></header><section itemProp="articleBody"><h2>I will never forget the first time I killed the music in a local coffee shop.</h2>
<p>Struggling to teach myself “machine learning”, I decided to download large dataset from the internet. As is typical with these types of workloads, the download size was well over 100 GB.
When I clicked download, Google Drive split the file into several chunks available to download simultaneously.</p>
<p>The competing music streaming device yeilded immediately, and acoustic pop covers were replaced with <a href="https://en.wikipedia.org/wiki/4%E2%80%B233%E2%80%B3">4’33”</a> on repeat until I realized what I’d done.</p>
<p>I think that browsers are actually polite by default. If we begin a single download of a file, the download code doesn’t try to use up all of the bandwidth and will likely only download one part at a time. This is what allows the network to live in harmony, with multiple people able to download what they need at a reasonable speed.
This Drive download acted differently and it felt sort of powerful.</p>
<h2>Bandwidth</h2>
<p>The Media &#x26; Entertainment Industry struggles with a similar problem with large files. The original formats of files from the camera will typically exceed hundreds of Gigabytes. To cope with the long transfer times, a proprietary industry standard tool, Aspera, has been the de facto leader. Aspera uses a custom protocol (FASP) to transfer files and uses a browser plugin to implement the protocol.</p>
<p>Aspera is brilliant <sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup>. The user can manually alter their upload speed and quickly meet the constraints of their hardware.</p>
<p>Recently, Aspera added integrations with cloud object storage, such as s3. But I wonder if this misses the point. Object storage <strong>is</strong> a service in front of storage already. Can we push these existing servers to their limit with coffee shop buckling magic?</p>
<h2>A sink</h2>
<p>The general reason we want to transfer large assets to a centralized location is that the source created something valuable. The sensor on the camera shooting Selling Sunset in 4K produces, for now, uniquely valuable information. Reams of sensor data must be shipped back to home base for post prodcution to be around computers that can handle the job.</p>
<p>Starting out, this is how it can be done.
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 504px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/1a593cb03bc811628806e8de05692f88/08115/s3_simple.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 47.46835443037975%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAACfklEQVQoz1WQ309SARTHzxXM6sXmU0+t5lPpmOKakteFP0qjNV1aD66HXHO9+NQf0Gq9uLZ6srXpmoW5zH6YVy4hE3/ce0GBSOFe4AKKIBdFMMNKs4ROu2y5/G7nPHy389n3fAERYYaPDbgiabSJ65sU61bLnnHWR5mdoSWTPeAxcLwww8fczvDXmNkZvOlLZkBMZfPwMMAwqYL5yyTMNWlyAxlEYARp1MDxyHpX8Z3F2SwDKcadfGXk8O2EA83OIM6FUuiJ7+C0J3p3aQtBjKaVdh2ZR9eWAz65B29qVIR8B/KanF/uYwTpG8PHNiyfw5rwdwSzM9hL27xTBo43Wv2JcfviF8NsYJ0z2cVWMY25OzlRqKUmHyWLDMx5EN1GeD4ycWTaEy0cMlkLu3v6Ff5UFhp0LcoBalrZ2t5RAADHAEABAPlKgLzOU8fBVFtxlNKWF+s1JbMuHfn4fumJIrzVpoTYTwT96JScCEaZBZCV69WzQtvEhMT5VgOMIIVtYsI/F0oladZ92zcyBj1kmcalIzOUVo3PKs/g4LlSF37oL4AdRDBYBfltoneIzvUgz7gjEBvjeKRtXhx3BHByfhnd0jaa7eID3EV4VF2m/aSrRkvD2d3XpAr1mpIwctQh+F9VNXXwDzi1EHnKCvFJRpAMrDduZL3xMat/jf3IedqGux9C33l1haNJE7Vea8T3F6uyLypP00jpCw4A65qu7AMX0wjixh8IbiIs/0CIbCMkEWElg9COCGvNWrlTxSCperl0tb4LO69DtO2C4gCw/lLzPlD6hUR8D4nVPSQSWSTWEYktRCLyG4EAAL6xEnrUxXJS2OlohTsniwC7bsBf+7eXaT9lAScAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="png"
        title="png"
        src="/static/1a593cb03bc811628806e8de05692f88/08115/s3_simple.png"
        srcset="/static/1a593cb03bc811628806e8de05692f88/c26ae/s3_simple.png 158w,
/static/1a593cb03bc811628806e8de05692f88/6bdcf/s3_simple.png 315w,
/static/1a593cb03bc811628806e8de05692f88/08115/s3_simple.png 504w"
        sizes="(max-width: 504px) 100vw, 504px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span>
This is fairly straightforward.</p>
<h2>And a wait</h2>
<p>The problem makes itself apparent when the source size exceeds memory capacity. What happens when the file is 15 times larger than your memory capacity? To get around this we leave the rest of the file on disk and only read one chunk at a time and send it.
Scale up the file to 400 GB. Libraries usually reccomend a chunk size. This chunk size is often less than 100 MB. For each request, it comes in phases that will often look like this drawing:</p>
<p>Standard chunked upload of a file.
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 583px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/b01ecf09c721e5ca7d168ead92c421aa/9fc4b/s3_chunk.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 71.51898734177216%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAADsUlEQVQ4y4WUa0xTZxjH/+fAJMwhfpDFZS5mESFIsGsoIDdhikqduiUjE1hiFrcPxmSym1vm3BZ1i1uykCUYlTAZm7rCRKQ3ajml5fTe00NbeoFe1pbQWhHGwDnjnMne5Zy4fVt4kv+35/m9z+WfF3gcGlsQ5mAaN0weqK2BFjaQOs76Z48xfOzYmDdxXM9F9id+JyCEoOuH62JNy7N5KFsNqBqluNe2VxS++1kHgydOD7NeOv2Q0ELBIOOKDOgdRGWeJCOOKWIJpol1KmMHQC0QQj0kBLbdFeivK4OzuYYe3i7BxYpi2tBUQaFboYFhIg49F8E7J86IL2ttwfMq86RXaw9ZXbFfrXxiyWcOpr8CQB957wQt5HRXlmCgrgwueQ3CB2qpc7IiGJsqgQtXlblGb7KW4WPbflQanwSQ3dmjWKu2+Nd98PnXGzo+Pr3+o9PfFLx78ss8AKueWpNPicCqUnj21uYO1kv2KBukHLu76vVLVSVrMGjgSh3R+UfO2AIZdcfeEEYe8yaU5mB62RxMp62hTMqd+O2uPTzXK3S479W2rE+rJFnjTeXoqy6VOZqr/75eJyG9VSXEuKuyDSP2kIThY8TomxH29ck8IbjpCnu09hDRc1FimIgTLr5IbNNzowByNhWV5FauL8glyi/QJSuud8lrCLtv+6O+6lJi2Ck7jO+HmAJ7+M5JR+TOGZ1zWjrmSWDUHa3j4osvK1nfjlF3tHHcP/uK1h6SCet46+0PxUt3SjdD2ygtYJoqThn2N9xV75SdG67fWoi+IQZcfFHUqDsqKIvhf4EvdV/o9LDWFmyZTN9Hz8AIiku3rhIu/VrhczhV9jx1QbYZ99pfQn954RbQgLu5GriiHocllMm2Td/O1lgDdL/Ohp+0lnyGj10a8yYJn1wmbCD17fufnRWOktf+5lHxKPoXX8B5WRG12CrP6i8vxKb8LMq5Zxv9r69xtqtXHEWQOZi+Zg/Pkb4h5sGYN/GX/9YDojL7rgB4mhBCKVkf1uU8gYMb8rGrIAeqBim13CrHUqv8Px66FWoEMn+KQD0X2cjwMZXa4ie28Byxh+cUQ0b+mR3NBwSbiTkrxk1XBENGHtcYF6xTt5H8g8Dkm+lQ6GwdAsDkm8FjS8HoTa4MHB73Cp4UgGsNnvghS+jWocsq08HOHsVRjS1whPXPtl9UqFdfVo1DobOuDNRzEVprDwmfxBZHZH7GnVjKKFlfRuecTvHJ5YwzuhC7qjFvFCa4YZqg/g/0D3QkAitOQOHlAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="png"
        title="png"
        src="/static/b01ecf09c721e5ca7d168ead92c421aa/9fc4b/s3_chunk.png"
        srcset="/static/b01ecf09c721e5ca7d168ead92c421aa/c26ae/s3_chunk.png 158w,
/static/b01ecf09c721e5ca7d168ead92c421aa/6bdcf/s3_chunk.png 315w,
/static/b01ecf09c721e5ca7d168ead92c421aa/9fc4b/s3_chunk.png 583w"
        sizes="(max-width: 583px) 100vw, 583px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<p>When dealing with this type of web request, the typical loop looks like this in a straightforward loop.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/93d8656cd01125fb68a90be8e216a08c/cc155/s3_time.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 15.822784810126581%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA9ElEQVQI12PYd3anzrGrB3Lvnd+V8uzCrrQn53elPb2wK+3TnSNpn+4cBeOPt4+knby4N+30pb1pj8/uSHt2cXfawzPb015d2QeX/3TnaMarq/siGbYe2Ziy78yOn7dOb7v/4NTWx/dObX18//TWx5/uHH38+e6xx59B9J2jj4+f3/3o5MU9j+6f2vro8bkdj24f3/zo5ZV9j749OPHoy91jD7/eP/7s7Y2DRxlsnazZTK1MBPtbythm9dSyz+6tY5/RVcPuYGXCbmdhxG5lasBuZ27I9v//f6b///8zQ2kofsbUVpXLtHBSM9PcvgamGV01TAAESp3uDOobkwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="png"
        title="png"
        src="/static/93d8656cd01125fb68a90be8e216a08c/f058b/s3_time.png"
        srcset="/static/93d8656cd01125fb68a90be8e216a08c/c26ae/s3_time.png 158w,
/static/93d8656cd01125fb68a90be8e216a08c/6bdcf/s3_time.png 315w,
/static/93d8656cd01125fb68a90be8e216a08c/f058b/s3_time.png 630w,
/static/93d8656cd01125fb68a90be8e216a08c/cc155/s3_time.png 886w"
        sizes="(max-width: 630px) 100vw, 630px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<p>You can see that stacking multiple requests can add up over time. Come to think of it, is there really a strict dependency on the last web request finishing from s3? If the target can handle it, we shouldn’t care either. Let’s get something going like this:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/319a29518c8545c702d90762dcf7240c/ef3e1/s3_async.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACuElEQVQoz22SzU/TcBjHH148SOLJxGR6FmY8eeEvMDHevOlRj5496EGPSIx4EAWVNw8w5GUKC7CuXftruxVYO1i7toyxsbEVtnXjHYUN9/Iz7UFD4pM8eW6f5/t8vw9gjMFqmhiD5OIsqJwbEkse0Dg3cDNDwM8M2x2YHYEw6QL3cA/cud0BEf83+G+97HrR9ujxww7XaO813/SAY2G8z0FPf3EQ432O0Y9dDlf/a8fkwBvH+Kfu6/6pz1fx+VZLQaWb8WEMcEmFfNR/EegPLTxlFRrHVXrPCM3lcwpVTEsLpR2ZLJ4bUrGcEYun6eXC2Vbo5GAjgPC+DqU1BEeJYEtKnGsq6ghKOvoHZMJEJ6+h55EovaLrLN7RETYVCpd0hPdiHD5KBHElK+FKVsS/0kv7x0mhv6SjJwfxgG1LLuqHgkrDjkzCdoQE0LNhENY4ICXvM6QhY0Nl9rOKv17QmJoR8dVLOqpXDKlezoTq5YzYsOBHiaCUCXtvGhHfDUvUcVJowqYC2JQBxPVAk5qXW9Ci5/KyGQV2xccLGsK5Nfa3qVDVgko3tsJevL/O43o+YgGr5YxYKWdFvBtjuxv5CJga03S4EWy1FMNX9yC4qQk7aVJcAF6hO4nluQfhKL2nxjhsakzdVKiGqTGNnEI1TpJC49xWbFuQ/plaQjsyeXdvnbM/ASYJF0wRLng/2AMe7kczkikoNHLAyP7eoMoEkjqqbGmMBcY5hcKHG0F8ml7GZ5mQfb6l9CDOj+zG2Hspcd7xNxwxHgRBZ2FxjWsWdLYVxXjoefvqCiP7zZUYj7cjZDWvUDVj1VdLi/O1k02hfm5I1XJWrFQMyVqAt2Xy/oUX+k5N2PPD0DvbAiY0f0nQ0M2g5L2VXSGcxirhzCmUs6DSzkzY69wMzTlT4rw12xNLnnaRGGv7AzRxAmQy3himAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="png"
        title="png"
        src="/static/319a29518c8545c702d90762dcf7240c/f058b/s3_async.png"
        srcset="/static/319a29518c8545c702d90762dcf7240c/c26ae/s3_async.png 158w,
/static/319a29518c8545c702d90762dcf7240c/6bdcf/s3_async.png 315w,
/static/319a29518c8545c702d90762dcf7240c/f058b/s3_async.png 630w,
/static/319a29518c8545c702d90762dcf7240c/ef3e1/s3_async.png 759w"
        sizes="(max-width: 630px) 100vw, 630px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<p>Quite literally, 7 requests can happen in the time of two requests. The tradeoff is that we are a bit rude on the network and hog our own networking card for resources. If no constraints are in place we could very well use up all of the bandwidth.</p>
<p>The power is in the ability to wait for multiple chunks to complete at the same time.</p>
<h2>Not Magic</h2>
<p>Can we just keep lobbing chunks at the network until it is saturated? Well not quite. Yet again we run into memory constraints. Each of those chunks may require a retry, and in order to do so I hold on to the buffer in memory.</p>
<p>This introduces a slew of other problems. To demonstrate the complexity we take on, I will put off the buffering mechanism to another post.</p>
<p>To get a look at the code you can find it <a href="https://github.com/nickdnickd/botnica">here</a>.</p>
<div class="footnotes">
<hr>
<ol>
<li id="fn-1">
<p>That’s not say Aspera didn’t have its own quirks in the field. In atypical network environments for documentary filmmakers, we saw issues particularly within univerisity networks. And it is pretty expensive. On top of the current infrastructure, it costs about $1 USD per GB transferred in their SaaS offering. Under enough load these Faspex servers would also go down.</p>
<a href="#fnref-1" class="footnote-backref">↩</a>
</li>
</ol>
</div></section><hr/><footer><div class="bio"><div data-gatsby-image-wrapper="" style="width:50px;height:50px" class="gatsby-image-wrapper bio-avatar"><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#c8c8c8;width:50px;height:50px;position:relative"></div><picture><source type="image/avif" data-srcset="/static/692ba8483cfc1555f4fa9874f4defa2e/d4bf4/profile-pic.avif 50w,/static/692ba8483cfc1555f4fa9874f4defa2e/ee81f/profile-pic.avif 100w" sizes="50px"/><source type="image/webp" data-srcset="/static/692ba8483cfc1555f4fa9874f4defa2e/3faea/profile-pic.webp 50w,/static/692ba8483cfc1555f4fa9874f4defa2e/6a679/profile-pic.webp 100w" sizes="50px"/><img data-gatsby-image-ssr="" layout="fixed" data-main-image="" style="opacity:0" sizes="50px" decoding="async" loading="lazy" data-src="/static/692ba8483cfc1555f4fa9874f4defa2e/d24ee/profile-pic.jpg" data-srcset="/static/692ba8483cfc1555f4fa9874f4defa2e/d24ee/profile-pic.jpg 50w,/static/692ba8483cfc1555f4fa9874f4defa2e/64618/profile-pic.jpg 100w" alt="Profile picture"/></picture><noscript><picture><source type="image/avif" srcSet="/static/692ba8483cfc1555f4fa9874f4defa2e/d4bf4/profile-pic.avif 50w,/static/692ba8483cfc1555f4fa9874f4defa2e/ee81f/profile-pic.avif 100w" sizes="50px"/><source type="image/webp" srcSet="/static/692ba8483cfc1555f4fa9874f4defa2e/3faea/profile-pic.webp 50w,/static/692ba8483cfc1555f4fa9874f4defa2e/6a679/profile-pic.webp 100w" sizes="50px"/><img data-gatsby-image-ssr="" layout="fixed" data-main-image="" style="opacity:0" sizes="50px" decoding="async" loading="lazy" src="/static/692ba8483cfc1555f4fa9874f4defa2e/d24ee/profile-pic.jpg" srcSet="/static/692ba8483cfc1555f4fa9874f4defa2e/d24ee/profile-pic.jpg 50w,/static/692ba8483cfc1555f4fa9874f4defa2e/64618/profile-pic.jpg 100w" alt="Profile picture"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1)}}</script></div><p>Written by <strong>Nick D</strong> <!-- -->who wants to remember interesting EE topics.</p></div></footer></article><nav class="blog-post-nav"><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/web-scraping/2020-09-12-Avoiding-Manual-Data/">← <!-- -->Avoiding Manual Data Entry</a></li><li><a rel="next" href="/crypto-taxes/2021-3-1-Crypto-Taxes/">IRS v BTC<!-- --> →</a></li></ul></nav></main><footer>© <!-- -->2021<!-- -->, Built with<!-- --> <a href="https://www.gatsbyjs.com">Gatsby</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/async-uploads/2020-11-1-Async-Uploads/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-de6f229c0a3977155403.js"],"app":["/app-53f7db7d85c07ecc7c96.js"],"component---src-pages-404-js":["/component---src-pages-404-js-97593667e44e4660bc60.js"],"component---src-pages-index-js":["/component---src-pages-index-js-3929009247225dd2f8b4.js"],"component---src-pages-using-typescript-tsx":["/component---src-pages-using-typescript-tsx-ec89e82605e2a0c5e9c7.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-b372affe070b4abe70a5.js"]};/*]]>*/</script><script src="/polyfill-de6f229c0a3977155403.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-b372affe070b4abe70a5.js" async=""></script><script src="/commons-ab2410dfbec4227df496.js" async=""></script><script src="/app-53f7db7d85c07ecc7c96.js" async=""></script><script src="/framework-341c3c82f92be86019fb.js" async=""></script><script src="/webpack-runtime-9b020be59ce6ce109edf.js" async=""></script></body></html>